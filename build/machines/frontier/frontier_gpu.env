#!/bin/bash

source ${MODULESHOME}/init/bash
module reset
module load PrgEnv-amd cray-parallel-netcdf cmake craype-accel-amd-gfx90a cray-hdf5 cray-netcdf

export ROCM_PATH=${CRAY_AMD_COMPILER_PREFIX}

export MPICH_GPU_SUPPORT_ENABLED=1

export PORTURB_HOME=`pwd`/..
export PORTURB_ARCH=hip
export PORTURB_DEBUG=OFF
export PORTURB_CXX_FLAGS="-DPORTURB_GPU_AWARE_MPI;-DPORTURB_FUNCTION_TIMERS;-munsafe-fp-atomics;-O3;-ffast-math;-I${ROCM_PATH}/include;-D__HIP_ROCclr__;-D__HIP_ARCH_GFX90A__=1;-Wno-unused-result;-Wno-macro-redefined;-DYAKL_ARCH_HIP"
export PORTURB_F90_FLAGS="-O2 -DSCREAM_DOUBLE_PRECISION"
export PORTURB_LINK_FLAGS="--rocm-path=${ROCM_PATH};-L${ROCM_PATH}/lib;-lroctx64;-lrocfft;-lamdhip64"

export CC=cc
export FC=ftn
export CXX=CC

unset CXXFLAGS
unset FFLAGS
unset F77FLAGS
unset F90FLAGS

